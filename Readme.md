# 微信墙弹幕（软院学生节）

## 部署说明

* 操作系统：win10 64位

### 微信墙（侧投）

* 配置微信公众号：

开发->基本配置

```
url: http://39.96.29.143/receive

Token: wewall2018

消息加密方式：明文加密
```

提交并启用配置

* 爬取微信头像：

1. Chrome浏览器登录微信公众号后台
2. 按下F12（或右键检查/inspect）
3. 打开Network选项卡，刷新页面
4. 单击前缀形如home?t=home/index这一项
5. 复制Request Headers中的Cookie:后的内容
6. 粘贴至WeWallUserInfo/config.py中的Cookie=‘’的单引号内
7. 将浏览器地址栏内的token值（一串数字）复制到config.py中的token=''的单引号内
8. 建议事先爬取一遍所有用户微信头像（双击`pre.bat`）
9. 晚会开始之前重复一下以上操作，并且晚会进行中不要登陆微信公众号，否则cookie会变，晚会进行中的微信头像爬取主要爬取新关注的用户以及更改了头像的用户

* 运行：

1. 双击`start.bat`
2. 浏览器打开 http://127.0.0.1:8080（微信墙界面，幕布显示）
3. 浏览器打开 http://127.0.0.1:7070（审核界面，电脑端审核）
4. 请确保侧投电脑始终处于联网状态，若中途出现断网，请关闭所有命令行窗口重新打开start.bat并刷新上述两个页面

### 弹幕（主投）

【若不需要弹幕可跳过】

1. 双击打开danmu/danmu-client.exe
2. 按下回车键
3. 最小化程序



Powered By 软件学院科协

## 简单说明

### Ver 2.0说明

由2020届科协技术部主导开发。

这一版本fork自第一版，并进行了一些修复和更新。

### Ver 1.0说明

由2018届科协技术部主导开发。 [@dingzheng2016](https://github.com/DingZheng2016)、[@gerwang](https://github.com/gerwang)、[@dimlight1998](https://github.com/DimLight1998) 是主要的开发人员。

这次的微信墙和弹幕系统本来是想借鉴往届学长以及GitHub上面现成的项目的，但后来发现对NodeJS和PHP都不是很熟，加上代码版本过旧于是重新写了一套，虽然最后还是使用了NodeJS 233。方案实现上有些地方不太优雅，架构上可能不够紧凑。

## 架构及任务说明

#### 架构

* 服务器：处理消息请求，数据库。
* 微信墙客户端：显示微信墙内容，本地读取远端数据库内容。
* 更新系统：获取用户信息，包括用户名及头像。
* 审核系统：本地读取远端数据库进行消息审核。
* 弹幕系统：弹幕显示。

#### 任务说明

* 服务端微信墙客户端更新系统由我负责，审核系统张洋负责，弹幕系统凌精望负责。

## 服务端

* Django框架，接受微信公众平台推送过来的xml消息，作处理后存入数据库
* 环境
  * `Ubuntu16.04`
  * `Apache2.4.18`
  * `Python3.5.2`
  * `Django2.0.3`
  * `MySQL5.7.12`

## 微信墙客户端

* NodeJS监听本地8080端口，读取远端数据库数据
* 网页使用ajax获取最新消息
* 动画使用jQuery制作
* 环境
  * `Windows10 64位`
  * `node 8.10.0`

## 更新系统

* 获取用户信息及头像，预先获取所有数据，使用时不断更新获取新关注用户的信息
* 环境
  * `Windows10 64位`
  * `Python3.6.4`

## 审核系统

* 读取远端数据库并审核
* 环境
  * `Windows10 64位`
  * `C#(Visual Studio)`

## 弹幕系统

* 本地播放弹幕
* 环境
  * `windows10 64位`
  * `node 8.10.0`
  * `electron 1.8.4`

